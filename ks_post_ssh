
## CONFIGURE SSH
echo "Configure sshd"
## Root ssh keys
mkdir -p /root/.ssh
chmod 700 /root/.ssh
cat << EOF >> /root/.ssh/authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA30vcy0LtvLP4JxttyB7iEUr3KwU949R4w3d9B2zuRF0ZxD+EORVZK9/vku4QBwvjXaZb26A6NAQANlopOE+otEo2cueWzO7EmPJrwCA1PCF71FIyNcC/mFZpofvm7joRGlDnRYw9eW1cY77TvQZi2nYLEK5f3YC+fJK4qyylaNcL3Rpw63prmDutvdBtFsoXdvxuVXdSzlBTMo9+SVxze9Xh0VhPZ0SOQBtTtRzPsfaKJrB5nqVewrtUpNfc0TfBLnZxP9SfKh9yJE5tnZ2hnH2un6E/kobtt6NVi3uRqsfypjJGMe/4A6O12+VKzQ0dvcnqGu7v6Q3apDWvbdZjdQ== root@monitor.spacescience.ro
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA2baMQLiJeFJiuVgWdzmv95UtNJ0Fi2P5huFjKcVNKPqnbnbEw58sMzjG2qSogB1olpx+BjSf2A18su0hltx6E/EKKjVgVM5zqYPKsmc6wrtqVwXgTuCNoLlFMWFJbwU3iHcealm8ekyJwIPjv6g2p3+AL3G6xmk1FK86Qo5SxcPWr0lcde+c0LnuZwQwa/qV2WsWQfdA8kta4f8jd+anfCxQrqn33qnb1d9Cu8FYr1uYuvWnFIZIrvKco0r0azx3OLiDk6U4wtFdoSa+k2+FYFi/hrQiwVJRrBupC4xJiJO6GOhSL7/lRCaQ/PByhAhPK/fIwD4wYTfNXDDM26+/JQ== adrian@sev.spacescience.ro
ecdsa-sha2-nistp521 AAAAE2VjZHNhLXNoYTItbmlzdHA1MjEAAAAIbmlzdHA1MjEAAACFBABFIo4zMXhmrTu7jAcBHFfJrc5Jen+6SW60+bZY1TfZsdGaZEG/CMZugJk+S+3RABTT6W9rf2kzF1dHvzjQbmxFQADtnRVYlYpl+Xr1LraN8THgMSe56GMmj05s0pAwGZHSeE4CCCyv3pkXJLUPyF5cTidRbR1lCiRwtgLGbecOtMGPhg== adrian@sev.spacescience.ro

EOF

# change the ssh port and permit root logon
/usr/bin/sed -i 's/#Port 22/Port 60000/;' /etc/ssh/sshd_config

cat << EOF >> /etc/ssh/sshd_config

Match Address 127.0.0.1,85.120.46.0/26,46.243.114.128/25,10.10.8.0/22,172.20.0.0/24
PermitRootLogin yes

EOF


## permit in selinux the 60000 port
# semanage port -a -t ssh_port_t -p tcp 60000

## make sure the ssh is configured

## add ssh port to iptables
if [[ -e /etc/sysconfig/iptables ]] ; then
    cp /etc/sysconfig/iptables /etc/sysconfig/iptables_ini_sshd_cfg
    sed -i 's/--dport 22/--dport 60000/' /etc/sysconfig/iptables
    sed -i 's/--dport 22/--dport 60000/' /etc/sysconfig/ip6tables
    systemctl restart iptables ip6tables

else
    firewall-cmd --set-default-zone=public
    firewall-cmd --permanent --zone=public --add-port=60000/tcp
    firewall-cmd --permanent --zone=public --remove-service=dhcpv6-client
fi

echo

